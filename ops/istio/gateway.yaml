apiVersion: gateway.networking.k8s.io/v1beta1
kind: Gateway
metadata:
  name: internal-lb-gateway-core
  namespace: istio-system
  annotations:
    service.beta.kubernetes.io/azure-load-balancer-internal: "true"
    service.beta.kubernetes.io/azure-load-balancer-health-probe-request-path: "/healthz/ready"
    service.beta.kubernetes.io/port_80_health-probe_protocol: http
    service.beta.kubernetes.io/port_80_health-probe_port: "15021" # envoy listening on 15021
    cert-manager.io/cluster-issuer: certissuer-letsencrypt
spec:
  gatewayClassName: istio
  listeners:
   - name: http-kiali
     hostname: "kiali.myhandymanpro.net"
     port: 80
     protocol: HTTP
     allowedRoutes:
      namespaces:
        from: All
    #  tls:
    #   httpsRedirect: true

   - name: https-kiali
     hostname: "kiali.myhandymanpro.net"
     port: 443
     protocol: HTTPS
     allowedRoutes:
      namespaces:
        from: All
     tls:
        mode: Terminate # ✅ Required. "Terminate" is the only supported mode.
        certificateRefs:
          - name: cert-myhandymanpronet # ✅ Required.
            kind: Secret  # ✅ Required. "Secret" is the only valid value.
            group: "" # ✅ Required. "core" is the only valid value.

   - name: http-apis
     hostname: "apis.myhandymanpro.net"
     port: 80
     protocol: HTTP
     allowedRoutes:
      namespaces:
        from: All
      kinds:
        - group: gateway.networking.k8s.io
          kind: HTTPRoute

   - name: https-apis
     hostname: "apis.myhandymanpro.net"
     port: 443
     protocol: HTTPS
     allowedRoutes:
      namespaces:
        from: All
      kinds:
        - group: gateway.networking.k8s.io
          kind: HTTPRoute
     tls:
        mode: Terminate # ✅ Required. "Terminate" is the only supported mode.
        certificateRefs:
          - name: cert-myhandymanpronet # ✅ Required.
            kind: Secret  # ✅ Required. "Secret" is the only valid value.
            group: "" # ✅ Required. "core" is the only valid value.